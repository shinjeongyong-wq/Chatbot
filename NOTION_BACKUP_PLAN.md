# 📋 노션 데이터 백업 계획서 (Rev 2.0)

**작성일**: 2026-01-19  
**최종 수정**: 2026-01-19T21:34:00+09:00  
**프로젝트**: 개원 상담 챗봇 (오픈닥터)  
**목적**: Notion 데이터를 로컬에 백업하여 챗봇 RAG 시스템의 데이터 소스로 활용

---

## 📌 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2026-01-19 | 초안 작성 |
| **2.0** | 2026-01-19 | **"개원 시 필요 영역 [기본편]" 18개 하위 페이지 추가, 전체 페이지 수 212개+ 확인, 데이터베이스 30개+ 확인** |

---

## 1. 개요

### 1.1 배경
- 현재 챗봇은 Google Sheets + 로컬 Notion 데이터(`notionData.js`)를 데이터 소스로 사용
- Notion 데이터는 수동으로 하드코딩된 상태 (약 60개 항목)
- **문제점**: 실시간 API 호출은 트래픽 과부하 및 불안정성 유발 (일반 유저 대상 서비스)

### 1.2 목표
| 항목 | 설명 |
|------|------|
| **데이터 완전성** | Notion의 모든 페이지/블록을 계층적으로 100% 백업 |
| **효율성** | 한 번 백업 후 로컬 캐시 사용 (API 호출 최소화) |
| **유지보수성** | 수동 업데이트가 쉬운 구조 + 버전 관리 |
| **품질** | 중복 제거, 포맷 정규화, 메타데이터 보존 |

---

## 2. Notion 전체 구조 분석 결과 (2026-01-19 탐색 완료)

### 2.1 규모 요약

| 항목 | 개수 |
|------|------|
| **총 페이지 수** | 212+ |
| **총 데이터베이스 수** | 30+ |
| **메인 콘텐츠 페이지** | ~50개 |
| **데이터베이스 레코드** | 160+ |

### 2.2 루트 페이지
```
📘 플래너 AI (2ed62ade-d336-8064-a192-e1269201fbd2)
├─ 마지막 수정: 2026-01-19T07:35:00.000Z
└─ 접근 가능한 Notion 워크스페이스에서 확인됨
```

---

## 3. 전체 페이지 구조 (계층별)

### 3.1 Level 1: 메인 페이지 직속 콘텐츠

#### 📦 섹션 A: 파트너사 안내
| # | 페이지명 | ID | has_children | 콘텐츠 유형 |
|---|----------|-----|--------------|-------------|
| 1 | 은행 파트너사 (원장님용) (1) | `2ed62ade-d336-8020-9e41-ca4fc9bba4ac` | ✅ | 파트너사 |
| 2 | 오픈닥터 인테리어 파트너사 (1) | `2ed62ade-d336-80f5-b13d-cb2b6dd9a058` | ✅ | 파트너사 |
| 3 | 오픈닥터 간판 파트너사 (1) | (조회됨) | ✅ | 파트너사 |
| 4 | 오픈닥터 홈페이지 파트너사 (1) | (조회됨) | ✅ | 파트너사 |
| 5 | 오픈닥터 PC&네트워크, 통신&보안 파트너사 (1) | (조회됨) | ✅ | 파트너사 |
| 6 | 오픈닥터 가구 파트너사 (1) | `2ed62ade-d336-80d1-b13a-c8517760a5e5` | ✅ | 파트너사 |

#### 📦 섹션 B: 개원 시 필요 영역 [기본편] ⭐ (3컬럼 레이아웃)

##### 🏗️ 착공 이전 (컬럼 1) - Block ID: `2ed62ade-d336-8135-ac39-da8e1e84cb0f`
| # | 페이지명 | ID | has_children | 아이콘 |
|---|----------|-----|--------------|--------|
| 1 | 세무 | `2ed62ade-d336-8103-9e6e-de51093d8a06` | ✅ | 🧾 |
| 2 | 대출 | `2ed62ade-d336-81f1-99a5-cbb3e395186f` | ✅ | 🪙 |
| 3 | 인테리어 (기본편) | `2ed62ade-d336-8168-a1a2-d0d50dc50b63` | ✅ | 🔧 |
| 4 | 간판 (기본편) | `2ed62ade-d336-81f5-82b0-d13fa7f02e7e` | ✅ | 🪧 |
| 5 | 의료기기 (기본편) | (조회됨) | ✅ | 🔬 |
| 6 | 마케팅 | (조회됨) | ✅ | 📢 |
| 7 | 홈페이지 | `2ed62ade-d336-81e6-96e9-cbcf5d513c98` | ✅ | 🌐 |
| 8 | PC&네트워크 | `2ed62ade-d336-81c9-9478-d6cf7aa6cc9a` | ✅ | 💻 |
| 9 | 철거 및 운영 필수 설비 | `2ed62ade-d336-8185-8bd9-edc7afe92318` | ✅ | 👷 |

##### 🔨 인테리어 시공 중 (컬럼 2) - Block ID: `2ed62ade-d336-81b6-b761-e1a0a39c1bc9`
| # | 페이지명 | ID | has_children | 아이콘 |
|---|----------|-----|--------------|--------|
| 1 | 운영 지원 인프라 | `2ed62ade-d336-818a-b7a7-dc25a798169a` | ✅ | 📶 |
| 2 | 가구 | `2ed62ade-d336-8149-887c-e61d91650e65` | ✅ | 🪑 |
| 3 | 병원용 섬유류 | `2ed62ade-d336-8190-8560-f73d2cb03308` | ✅ | 🛏️ |
| 4 | 의료폐기물 | `2ed62ade-d336-8174-a6dd-c7a12af08248` | ✅ | ☢️ |

##### 📋 개설신고 접수 이후 (컬럼 3) - Block ID: `2ed62ade-d336-811a-83a5-cebb908a58d1`
| # | 페이지명 | ID | has_children | 아이콘 |
|---|----------|-----|--------------|--------|
| 1 | 행정 업무 | `2ed62ade-d336-812b-ba0e-f2540e3f2281` | ✅ | 👷 |
| 2 | 보험 | `2ed62ade-d336-812e-b72e-dafb6ce6b809` | ✅ | 🏛️ |
| 3 | EMR & CRM | `2ed62ade-d336-810b-9479-ebef4a791f69` | ✅ | 📋 |
| 4 | 원내 의약품 | `2ed62ade-d336-81ed-9c74-cd15fcd062a5` | ✅ | 💊 |
| 5 | 관리 관련 업체 | `2ed62ade-d336-8182-a34d-c4f0ea226c1b` | ✅ | 🔧 |

#### 📦 섹션 C: 심화 콘텐츠
| # | 페이지명 | ID | has_children |
|---|----------|-----|--------------|
| 1 | 의료기기 미용 편 (1) | `2ed62ade-d336-80a2-8c3f-faa0ba77b70c` | ✅ |
| 2 | 의료기기 치과 편 (1) | `2ed62ade-d336-80ff-9f3f-f2546be73092` | ✅ |
| 3 | 인테리어 심화편 (1) | `2ed62ade-d336-80da-9455-c663b339399b` | ✅ |
| 4 | 간판 심화편 (1) | `2ed62ade-d336-800e-9cd6-e7b023e5db8f` | ✅ |

#### 📦 섹션 D: 체크리스트/기타
| # | 페이지명 | ID | has_children |
|---|----------|-----|--------------|
| 1 | 중개팀→플래너팀 부동산 정보 점검표 (1) | `2ed62ade-d336-80f9-8ce2-de65ef35b74e` | ✅ |
| 2 | 행정업무 체크리스트 (원장님용) (1) | `2ed62ade-d336-801f-aac5-ea0017299ab8` | ✅ |

---

### 3.2 확인된 데이터베이스 (인라인 DB)

| # | DB 제목 | ID | 부모 페이지 | 레코드 수 (대략) |
|---|---------|-----|-------------|-----------------|
| 1 | 목록 | `2ed62ade-d336-81fe-8b32-e77f03b12400` | 부동산 정보 점검표 | 20+ |
| 2 | 📁오픈닥터 고객 포트폴리오 | `2ed62ade-d336-8159-bc69-e07eae8c0332` | 인테리어 파트너사 | 30+ |
| 3 | 📁오픈닥터 홈페이지 포트폴리오 | `2ed62ade-d336-8188-af65-e51e2a831780` | 홈페이지 파트너사 | 30+ |
| 4 | 인테리어 비교표 | `2ed62ade-d336-8191-9380-d0b00ef830fb` | 인테리어 파트너사 | 10+ |
| 5 | 간판 비교표 | (조회됨) | 간판 파트너사 | 10+ |
| 6 | 붙박이가구 | `2ed62ade-d336-8175-80db-dc7118239b77` | 가구 파트너사 | 5+ |
| 7 | 상세 조건 보기 (대출) | `2ed62ade-d336-8144-b549-fafb5577fd60` | 은행 파트너사 | 15+ |
| ... | (기타 20+ 데이터베이스) | ... | ... | ... |

---

## 4. 백업 대상 분류

### 4.1 우선순위 분류

| 우선순위 | 대상 | 예상 항목 수 | RAG 활용도 |
|---------|------|-------------|-----------|
| 🔴 **P1 - 필수** | 메인 콘텐츠 페이지 (세무, 대출, 인테리어 등) | ~50개 | 매우 높음 |
| 🟠 **P2 - 중요** | 파트너사 소개/비교표 | ~30개 | 높음 |
| 🟡 **P3 - 보조** | 포트폴리오 (병원 사례) | ~100개 | 중간 |
| ⚪ **P4 - 참고** | 체크리스트/점검표 | ~30개 | 낮음 |

### 4.2 백업 제외 대상

| 유형 | 이유 |
|------|------|
| 이미지/동영상 | URL만 저장 (실제 파일 백업 X) |
| 빈 페이지/블록 | 콘텐츠 없음 |
| 중복 레코드 | ID 기반 중복 제거 |

---

## 5. 백업 스크립트 설계

### 5.1 기술 스택
```
런타임: Node.js
API: Notion MCP (notion-mcp-server) 사용
출력: JSON + JavaScript 모듈
```

### 5.2 스크립트 구조
```
scripts/
├── notion-backup.js        # 메인 백업 스크립트
├── notion-backup-config.js # 설정 파일
└── utils/
    ├── notion-client.js    # API 호출 래퍼
    └── content-parser.js   # 블록 → 텍스트 변환
```

### 5.3 핵심 알고리즘 (개선된 버전)

```javascript
// 재귀적 페이지 탐색 (DFS) - 컬럼 블록 처리 포함
async function crawlPage(pageId, depth = 0, path = [], categoryName = '') {
    const explored = new Set(); // 중복 방지
    
    // 1. 페이지 메타데이터 조회
    const page = await getPage(pageId);
    explored.add(pageId);
    
    // 2. 페이지 블록(콘텐츠) 조회
    const blocks = await getBlockChildren(pageId);
    
    // 3. 블록 유형별 처리
    for (const block of blocks) {
        // ⭐ 컬럼/컬럼리스트 블록 처리 (중요!)
        if (block.type === 'column_list' || block.type === 'column') {
            const columnBlocks = await getBlockChildren(block.id);
            for (const colBlock of columnBlocks) {
                if (colBlock.type === 'child_page' && !explored.has(colBlock.id)) {
                    await crawlPage(colBlock.id, depth + 1, [...path, page.title], categoryName);
                }
            }
        }
        
        if (block.type === 'child_page' && !explored.has(block.id)) {
            await crawlPage(block.id, depth + 1, [...path, page.title], categoryName);
        }
        
        // 일반 콘텐츠 블록 저장
        if (isContentBlock(block)) {
            saveBlock(block, page, path);
        }
    }
    
    return results;
}

// ⭐ 자기 검증 (Self-Check)
async function selfCheck() {
    console.log('🔍 Self-Check 시작...');
    
    // 1. 탐색한 페이지 수 vs API 검색 결과 비교
    const searchResults = await searchAllPages();
    const exploredCount = explored.size;
    
    if (exploredCount < searchResults.length * 0.9) {
        console.error(`❌ 경고: 탐색 누락 가능! 탐색=${exploredCount}, 검색=${searchResults.length}`);
        return false;
    }
    
    // 2. 필수 페이지 존재 확인
    const requiredPages = ['세무', '대출', '인테리어', '간판', '의료기기', '마케팅', '홈페이지'];
    for (const pageName of requiredPages) {
        if (!results.some(r => r.question.includes(pageName) || r.metadata.topic.includes(pageName))) {
            console.error(`❌ 필수 페이지 누락: ${pageName}`);
            return false;
        }
    }
    
    console.log(`✅ Self-Check 통과: ${exploredCount}개 페이지 탐색 완료`);
    return true;
}
```

### 5.4 블록 유형 처리

| 블록 타입 | 처리 방식 | 특별 주의 |
|-----------|-----------|-----------|
| `heading_1`, `heading_2`, `heading_3` | 질문/주제 제목으로 사용 | |
| `paragraph` | 본문 텍스트로 추출 | |
| `bulleted_list_item` | 리스트 항목으로 포맷 | |
| `numbered_list_item` | 번호 리스트로 포맷 | |
| `toggle` | 접힌 콘텐츠 펼쳐서 추출 | ⚠️ has_children 확인 필요 |
| `child_page` | 재귀 호출로 하위 페이지 탐색 | |
| `callout` | 중요 정보로 마킹 | |
| `table` | 표 형식으로 변환 | |
| **`column_list`** | **컬럼 컨테이너 - 반드시 자식 탐색!** | ⭐ **누락 방지 핵심** |
| **`column`** | **개별 컬럼 - 자식 페이지 탐색 필수!** | ⭐ **누락 방지 핵심** |
| `image`, `video` | 메타데이터만 저장 (URL) | |
| `unsupported` | 스킵 (로그 기록) | |

---

## 6. 출력 데이터 형식

### 6.1 단일 항목 구조
```javascript
{
    id: "notion-tax-1",              // 고유 ID
    source: "notion",                // 데이터 소스
    pageId: "2ed62ade-...",          // 원본 Notion 페이지 ID
    question: "세무 관련 안내",       // 제목/질문
    answer: "개업 시 세무 절차는...", // 본문 내용
    metadata: {
        field: "개원 시 필요 영역",   // 대분류
        topic: "착공 이전 > 세무",   // 중분류 > 소분류
        path: ["플래너 AI", "개원 시 필요 영역", "착공 이전", "세무"],
        depth: 3,                     // 계층 깊이
        category: "착공 이전",        // 카테고리 (컬럼명)
        icon: "🧾",                   // 아이콘
        lastUpdated: "2026-01-19T05:28:00.000Z"
    }
}
```

### 6.2 파일 구조
```
c:\Users\igoma\dev\projects\opn\planner-ai\
├── notionData.js              # 기존 파일 (백업 후 대체)
├── notionData.backup.js       # 백업 전 원본 보존
├── data/
│   ├── notion-raw.json        # 원본 API 응답 (디버깅용)
│   ├── notion-processed.json  # 처리된 데이터
│   ├── notion-structure.json  # 페이지 구조 맵
│   └── notion-meta.json       # 메타데이터 (날짜, 통계)
└── scripts/
    └── notion-backup.js       # 백업 실행 스크립트
```

---

## 7. 실행 계획 (수정됨)

### 7.1 Phase 1: 전체 구조 탐색 (읽기 전용)
1. ✅ 루트 페이지에서 시작
2. ✅ 모든 `child_page` 블록 재귀 탐색
3. ✅ **컬럼 블록 내부 페이지 탐색 (착공 이전/시공 중/접수 이후)**
4. ✅ 전체 페이지 트리 맵 생성
5. **예상 결과**: 페이지 목록 + 구조도

### 7.2 Phase 2: 콘텐츠 추출
1. 각 페이지의 블록 콘텐츠 조회
2. 블록 타입별 텍스트 변환
3. Q&A 형식으로 정규화
4. **예상 결과**: JSON 데이터

### 7.3 Phase 3: 데이터 변환 및 저장
1. JSON → JavaScript 모듈 변환
2. `notionData.js` 파일 생성/업데이트
3. 메타데이터 기록 (날짜, 항목 수, 소스)
4. **예상 결과**: 프로덕션 사용 가능 파일

### 7.4 Phase 4: 검증 (Self-Check) ⭐
1. ✅ 탐색 페이지 수 vs 검색 결과 비교
2. ✅ 필수 페이지 (세무, 대출 등 18개) 포함 확인
3. ✅ 기존 `notionData.js`와 비교 (누락 체크)
4. ✅ 챗봇 테스트 쿼리 실행
5. **예상 결과**: 품질 보고서

---

## 8. Self-Check 체크리스트 ⭐

백업 완료 후 반드시 확인할 항목:

### 8.1 필수 페이지 존재 확인 (18개)

**착공 이전 (9개)**
- [ ] 세무
- [ ] 대출
- [ ] 인테리어 (기본편)
- [ ] 간판 (기본편)
- [ ] 의료기기 (기본편)
- [ ] 마케팅
- [ ] 홈페이지
- [ ] PC&네트워크
- [ ] 철거 및 운영 필수 설비

**인테리어 시공 중 (4개)**
- [ ] 운영 지원 인프라
- [ ] 가구
- [ ] 병원용 섬유류
- [ ] 의료폐기물

**개설신고 접수 이후 (5개)**
- [ ] 행정 업무
- [ ] 보험
- [ ] EMR & CRM
- [ ] 원내 의약품
- [ ] 관리 관련 업체

### 8.2 심화 콘텐츠 확인 (4개)
- [ ] 의료기기 미용 편
- [ ] 의료기기 치과 편
- [ ] 인테리어 심화편
- [ ] 간판 심화편

### 8.3 파트너사 확인 (6개)
- [ ] 은행 파트너사
- [ ] 인테리어 파트너사
- [ ] 간판 파트너사
- [ ] 홈페이지 파트너사
- [ ] PC&네트워크 파트너사
- [ ] 가구 파트너사

### 8.4 수량 검증
- [ ] 총 페이지 수 ≥ 50개 (메인 콘텐츠)
- [ ] 포트폴리오/레코드 ≥ 100개
- [ ] 빈 항목 0개

---

## 9. 수동 업데이트 절차 (운영)

```bash
# 1. 백업 스크립트 실행
node scripts/notion-backup.js

# 2. Self-Check 결과 확인
cat data/notion-meta.json

# 3. 변경사항 검토 (diff)
git diff notionData.js

# 4. 커밋 및 배포
git add notionData.js data/
git commit -m "chore: update notion data backup (YYYY-MM-DD)"
git push
```

### 9.1 권장 업데이트 주기
| 상황 | 주기 |
|------|------|
| 일반 운영 | 1주일 |
| 콘텐츠 대량 추가 후 | 즉시 |
| 버그 발생 시 | 즉시 점검 |

---

## 10. 리스크 및 대응

| 리스크 | 확률 | 영향 | 대응 |
|--------|------|------|------|
| API Rate Limit 초과 | 낮음 | 중간 | 요청 간 딜레이 추가 (100ms) |
| **컬럼 블록 내 페이지 누락** | ~~높음~~ → **해결** | ~~높음~~ | **컬럼 블록 자식 탐색 로직 추가** |
| 페이지 구조 변경 | 중간 | 높음 | 스키마 검증 + 알림 |
| 대용량 콘텐츠 (이미지 등) | 낮음 | 낮음 | 메타데이터만 저장 |
| 인코딩 문제 (한글) | 낮음 | 중간 | UTF-8 명시적 처리 |
| 중복 데이터 | 중간 | 중간 | ID 기반 중복 제거 |

---

## 11. 성공 기준

| 항목 | 기준 | 상태 |
|------|------|------|
| ✅ 페이지 탐색 완료율 | 100% (모든 하위 페이지 포함) | 대기 |
| ✅ **"개원 시 필요 영역" 18개 페이지** | 100% 포함 | ⭐ 추가됨 |
| ✅ 데이터 정합성 | 원본 대비 손실 0% | 대기 |
| ✅ 포맷 정규화 | 기존 `notionData.js` 구조와 호환 | 대기 |
| ✅ 메타데이터 보존 | path, field, topic 모두 포함 | 대기 |
| ✅ 실행 시간 | 5분 이내 | 대기 |
| ✅ Self-Check 통과 | 모든 필수 페이지 확인 | 대기 |

---

## 12. 다음 단계

**검토 후 승인되면 진행할 작업:**

1. [ ] 백업 스크립트 (`notion-backup.js`) 작성
2. [ ] Phase 1 실행: 전체 페이지 구조 탐색
3. [ ] Phase 2 실행: 콘텐츠 추출
4. [ ] Phase 3 실행: `notionData.js` 생성
5. [ ] **Phase 4 실행: Self-Check (필수 페이지 28개 확인)**
6. [ ] 문서화 및 운영 가이드 작성

---

**검토자**: [사용자]  
**상태**: 📝 검토 대기 중 (Rev 2.0)
